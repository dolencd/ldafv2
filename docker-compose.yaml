version: '3.8'
services:
    rabbit:
        image: rabbitmq:3-management
        ports:
            - target: 15672
              published: 8080
              protocol: tcp
              mode: host
        networks:
            - main

    redis:
        image: "redis:alpine"
        networks:  
            - main

    udp:
        build: "./packages/UdpConnection"
        ports:
            - target: 41234
              published: 41234
              protocol: udp
              mode: host
        networks:
            - main
        depends_on:
            - redis
            - rabbit
        environment:
            UDP_FORWARDING_SERVICE: test
            REDIS_HOST: redis
            REDIS_PORT: 6379
            RABBITMQ_ADDRESS: amqp://rabbit

    service:
        build: "./packages/Service"
        depends_on:
            - redis
            - rabbit
        environment:
            SRC_HTTP: http://192.168.42.103:5000/testservice.tar.gz
            REDIS_HOST: redis
            REDIS_PORT: 6379
            RABBITMQ_ADDRESS: amqp://rabbit
        networks:
            - main

    


networks:
    main: